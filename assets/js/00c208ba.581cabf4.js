"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[723],{167:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return c}});var n=a(3289);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(a),c=i,k=m["".concat(s,".").concat(c)]||m[c]||d[c]||o;return a?n.createElement(k,r(r({ref:t},u),{},{components:a})):n.createElement(k,r({ref:t},u))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8834:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var n=a(3830),i=a(2056),o=(a(3289),a(167)),r=["components"],l={title:"Automated Jobs Tutorial",description:"Guide on adding automated jobs"},s="Automated Jobs Tutorial",p={unversionedId:"automated_jobs_tutorial",id:"automated_jobs_tutorial",title:"Automated Jobs Tutorial",description:"Guide on adding automated jobs",source:"@site/docs/automated_jobs_tutorial.md",sourceDirName:".",slug:"/automated_jobs_tutorial",permalink:"/docs/automated_jobs_tutorial",draft:!1,editUrl:"https://github.com/OSU-Sustainability-Office/osu-sustainability-office.github.io/edit/main/website/docs/automated_jobs_tutorial.md",tags:[],version:"current",frontMatter:{title:"Automated Jobs Tutorial",description:"Guide on adding automated jobs"},sidebar:"Docusaurus",previous:{title:"Database",permalink:"/docs/database"},next:{title:"Energy Dashboard Graph Logic",permalink:"/docs/energy_dashboard_graphs"}},u={},d=[{value:"General Info",id:"general-info",level:2},{value:"Automated-Jobs Dev Setup",id:"automated-jobs-dev-setup",level:2},{value:"AWS ECR (Elastic Container Registry)",id:"aws-ecr-elastic-container-registry",level:2},{value:"Creating a new repository",id:"creating-a-new-repository",level:3},{value:"Pushing an image to an existing repository",id:"pushing-an-image-to-an-existing-repository",level:3},{value:"AWS ECS (Elastic Container Service)",id:"aws-ecs-elastic-container-service",level:2},{value:"Creating a new task definition",id:"creating-a-new-task-definition",level:3},{value:"Creating a new cluster",id:"creating-a-new-cluster",level:3},{value:"AWS Cloudwatch",id:"aws-cloudwatch",level:2},{value:"Testing Pipeline Guide",id:"testing-pipeline-guide",level:2},{value:"Step 1: Local Development Setup",id:"step-1-local-development-setup",level:3},{value:"Step 2: Local Testing (Node.js)",id:"step-2-local-testing-nodejs",level:3},{value:"Step 3: Docker Testing",id:"step-3-docker-testing",level:3},{value:"Step 4: AWS Deployment Testing",id:"step-4-aws-deployment-testing",level:3},{value:"Step 5: Cleanup and Final Verification",id:"step-5-cleanup-and-final-verification",level:3}],m={toc:d};function c(e){var t=e.components,l=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"automated-jobs-tutorial"},"Automated Jobs Tutorial"),(0,o.kt)("h2",{id:"general-info"},"General Info"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/OSU-Sustainability-Office/automated-jobs"},"Link to GitHub Repository")),(0,o.kt)("h2",{id:"automated-jobs-dev-setup"},"Automated-Jobs Dev Setup"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From the repository root, cd into the folder of the automated job you want to run (e.g., SEC, check-acq)."),(0,o.kt)("li",{parentName:"ol"},"Paste the env file into the corresponding automated job. ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://drive.google.com/drive/u/1/folders/1geuKCp-aTIrde2WdJkE3f_L2TsF46_O3"},"Link to .env files")," (Need to be a paid OSU Sustainability Office Employee to see this link)"),(0,o.kt)("li",{parentName:"ul"},'Env files that are used by automated jobs will have a file name like "automated-jobs-XXXX.env.txt" (e.g. automated-jobs-pacific.env.txt for the pacific power scraper). '),(0,o.kt)("li",{parentName:"ul"},"Env files need ",(0,o.kt)("inlineCode",{parentName:"li"},"DASHBOARD_API = https://api.sustainability.oregonstate.edu/v2/energy")," unless you are making changes to energy dashboard (more on this in Testing Pipeline section)"))),(0,o.kt)("li",{parentName:"ol"},"Ensure you are using the correct node version. Node version could potentially vary between automated jobs so refer to the README.md in folder of the automated job."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"npm i")," to install packages."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"node <Javascript file name>"),", e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"node readsec.js")," to run webscraper.")),(0,o.kt)("h2",{id:"aws-ecr-elastic-container-registry"},"AWS ECR (Elastic Container Registry)"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://us-west-2.console.aws.amazon.com/ecr/repositories?region=us-west-2"},"AWS ECR")," is the registry that stores and versions the Docker images for each automated job. Any update to a webscraper gets pushed to ECR as an image, and ECS automatically runs the newest image."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"alt_text",src:a(1080).Z,title:"image_tooltip",width:"1496",height:"664"})),(0,o.kt)("h3",{id:"creating-a-new-repository"},"Creating a new repository"),(0,o.kt)("p",null,"This is only necessary if a new automated job has been developed."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},'Click "Create repository"'),(0,o.kt)("li",{parentName:"ol"},'In the "General settings" section, enter the repository name'),(0,o.kt)("li",{parentName:"ol"},'Leave everything else as-is and click "Create"'),(0,o.kt)("li",{parentName:"ol"},"Proceed to ",(0,o.kt)("a",{parentName:"li",href:"./automated_jobs_tutorial#creating-a-new-task-definition"},"Creating a new task definition")," section")),(0,o.kt)("h3",{id:"pushing-an-image-to-an-existing-repository"},"Pushing an image to an existing repository"),(0,o.kt)("p",null,"Follow these steps when updating an existing automated job."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Prerequisites")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"AWS CLI must be installed"),(0,o.kt)("li",{parentName:"ul"},"Docker Desktop App must be running in background"),(0,o.kt)("li",{parentName:"ul"},"For ",(0,o.kt)("strong",{parentName:"li"},"Windows Users"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Windows PowerShell Admin",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If you are dealing with \u201cexecution of scripts is disabled on this system\u201d issue, then ",(0,o.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/54776324/powershell-bug-execution-of-scripts-is-disabled-on-this-system"},"this stack overflow article")," may be useful."))),(0,o.kt)("li",{parentName:"ul"},"Install the specific module for managing ECR through the AWS Tools for PowerShell using: ",(0,o.kt)("inlineCode",{parentName:"li"},"Install-AWSToolsModule AWS.Tools.ECR"))))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Steps")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From the ",(0,o.kt)("a",{parentName:"li",href:"https://us-west-2.console.aws.amazon.com/ecr/repositories?region=us-west-2"},"AWS ECR Private repositories list"),", navigate to the desired automated job."),(0,o.kt)("li",{parentName:"ol"},'Click "View push commands"'),(0,o.kt)("li",{parentName:"ol"},"Follow the AWS-provided push commands to authenticate, build, tag, and push your Docker image to the selected repository.")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Apple Silicon Macs require the ",(0,o.kt)("inlineCode",{parentName:"p"},"--platform linux/amd64")," flag."))),(0,o.kt)("h2",{id:"aws-ecs-elastic-container-service"},"AWS ECS (Elastic Container Service)"),(0,o.kt)("p",null,"AWS ECS is the service that runs the AWS ECR images as containers. ECS task definitions point to image URIs in ECR, so when you push an updated image to ECR, ECS can automatically pull and run the latest version."),(0,o.kt)("h3",{id:"creating-a-new-task-definition"},"Creating a new task definition"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From ",(0,o.kt)("a",{parentName:"li",href:"https://us-west-2.console.aws.amazon.com/ecs/v2/task-definitions?region=us-west-2"},"AWS ECS task definition page"),', click on "Create new task definition" > "Create new task definition" (not with JSON)'),(0,o.kt)("li",{parentName:"ol"},'Check the box for "AWS Fargate" as the launch type'),(0,o.kt)("li",{parentName:"ol"},"Leave Operating system/Architecture as-is"),(0,o.kt)("li",{parentName:"ol"},"We can typically use cheapest option for cpu/memory (0.25 vCPU/0.5 GB)"),(0,o.kt)("li",{parentName:"ol"},"In the Container details section, enter an appropriate container name."),(0,o.kt)("li",{parentName:"ol"},'For Image URI, click "Browse ECR Images" > ',(0,o.kt)("em",{parentName:"li"},"Your automated job ECR"),' > "Use image tag: latest"'),(0,o.kt)("li",{parentName:"ol"},"In the logging section, enter the following values for each key:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"- awslogs-group: /ecs/\n- awslogs-region: us-west-2\n- awslogs-stream-prefix: ecs\n- awslogs-create-group: true\n")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:")," If you are running into any issues, you can refer to an existing task definition's JSON configuration settings."),(0,o.kt)("h3",{id:"creating-a-new-cluster"},"Creating a new cluster"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From ",(0,o.kt)("a",{parentName:"li",href:"https://us-west-2.console.aws.amazon.com/ecs/v2/clusters?region=us-west-2"},"AWS ECS cluster page"),', click "Create cluster"'),(0,o.kt)("li",{parentName:"ol"},'Use default options and click "Create"'),(0,o.kt)("li",{parentName:"ol"},'Go to the newly created cluster and click "Scheduled tasks"'),(0,o.kt)("li",{parentName:"ol"},"Click update on an existing scheduled task for reference before making a new one (have them side by side on different tabs!)"),(0,o.kt)("li",{parentName:"ol"},"While testing something for the first time, it's a good idea to set the interval for running the CRON job as something like every minute or every 5 minutes. But once you are certain it works, make sure to turn the interval back to once every 24 hours or 48 hours etc.")),(0,o.kt)("h2",{id:"aws-cloudwatch"},"AWS Cloudwatch"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logsV2:log-groups"},"AWS Cloudwatch log groups")," can be used for debugging purposes and to verify that the automated job has executed."),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"/docs/cloudwatch"},"this page on Cloudwatch")," as well for more information"),(0,o.kt)("h2",{id:"testing-pipeline-guide"},"Testing Pipeline Guide"),(0,o.kt)("p",null,"Follow these steps in order to test your webscraper changes."),(0,o.kt)("h3",{id:"step-1-local-development-setup"},"Step 1: Local Development Setup"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Prerequisites:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Ensure Node.js, Docker Desktop, and MySQL Workbench are installed"),(0,o.kt)("li",{parentName:"ul"},"Have access credentials for the SQL database and Energy Dashboard API"),(0,o.kt)("li",{parentName:"ul"},"Have the ",(0,o.kt)("inlineCode",{parentName:"li"},".env")," file for your automated job (e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},"automated-jobs/SEC/.env"),") (",(0,o.kt)("a",{parentName:"li",href:"https://drive.google.com/drive/u/1/folders/1geuKCp-aTIrde2WdJkE3f_L2TsF46_O3"},"Link to .env files"),")")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Setup:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Navigate to your automated job folder (e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},"automated-jobs/SEC/"),")"),(0,o.kt)("li",{parentName:"ol"},"Install dependencies: ",(0,o.kt)("inlineCode",{parentName:"li"},"npm install")),(0,o.kt)("li",{parentName:"ol"},"Ensure you're using the correct Node version (check the README.md in the folder)")),(0,o.kt)("h3",{id:"step-2-local-testing-nodejs"},"Step 2: Local Testing (Node.js)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For webscraper-only changes:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Edit the ",(0,o.kt)("inlineCode",{parentName:"li"},"DASHBOARD_API")," value in your ",(0,o.kt)("inlineCode",{parentName:"li"},".env")," file to use the production URL:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"DASHBOARD_API = https://api.sustainability.oregonstate.edu/v2/energy\n"))),(0,o.kt)("li",{parentName:"ol"},"Run the webscraper: (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"node readsec.js"),")"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Success criteria:")," New data appears in the SQL database via MySQL Workbench")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For changes involving energy dashboard backend:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Start the energy dashboard backend locally: ",(0,o.kt)("inlineCode",{parentName:"li"},"sam local start-api")," (should run on http://localhost:3000)"),(0,o.kt)("li",{parentName:"ol"},"Edit the ",(0,o.kt)("inlineCode",{parentName:"li"},"DASHBOARD_API")," value in your ",(0,o.kt)("inlineCode",{parentName:"li"},".env")," file to use the local URL:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"DASHBOARD_API = http://localhost:3000\n"))),(0,o.kt)("li",{parentName:"ol"},"Run the webscraper: (e.g. node readsec.js)"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Success criteria:")," ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"New data appears in the SQL database"),(0,o.kt)("li",{parentName:"ul"},"Local frontend shows the data (check via Inspect Element > Network tab)")))),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"API_PWD")," in your automated-jobs env file should match the ",(0,o.kt)("inlineCode",{parentName:"li"},"AQUISUITE_PWD")," value that the energy-dashboard backend expects"),(0,o.kt)("li",{parentName:"ul"},"Reference these files for backend integration details:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/OSU-Sustainability-Office/energy-dashboard/blob/master/backend/dependencies/nodejs/models/meter.js#L141"},"meter.js model")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/OSU-Sustainability-Office/energy-dashboard/blob/master/backend/app/meter.js#L88"},"meter.js app"))))))),(0,o.kt)("h3",{id:"step-3-docker-testing"},"Step 3: Docker Testing"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Build the Docker image: ",(0,o.kt)("inlineCode",{parentName:"li"},"docker build . -t test"))),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Apple Silicon Macs require the ",(0,o.kt)("inlineCode",{parentName:"p"},"--platform linux/amd64")," flag."))),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Run the Docker container: ",(0,o.kt)("inlineCode",{parentName:"li"},"docker run -t test")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Success criteria:")," ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Container runs without errors"),(0,o.kt)("li",{parentName:"ul"},"New data appears in the SQL database")))),(0,o.kt)("h3",{id:"step-4-aws-deployment-testing"},"Step 4: AWS Deployment Testing"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For webscraper updates only:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You only need to push changes to ECR (not ECS)"),(0,o.kt)("li",{parentName:"ul"},"ECS should automatically pick up the latest ECR revision")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Deployment steps:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"./automated_jobs_tutorial#pushing-an-image-to-an-existing-repository"},"Push your Docker image to ECR")),(0,o.kt)("li",{parentName:"ol"},"Temporarily change the ECS scheduled task interval to 1 minute for testing:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Go to ECS > cluster > scheduled task > update"),(0,o.kt)("li",{parentName:"ul"},"Set interval to 1 minute"))),(0,o.kt)("li",{parentName:"ol"},"Monitor the deployment via Cloudwatch logs"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Important!!")," Once you see the run in CloudWatch logs, revert the scheduled task to its original interval"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Success criteria:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Check Cloudwatch logs for successful execution"),(0,o.kt)("li",{parentName:"ul"},"Verify data appears on production sites:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://dashboard.sustainability.oregonstate.edu/#/building/30/2"},"SEC Solar")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://dashboard.sustainability.oregonstate.edu/#/building/42/2"},"OSU Operations")))),(0,o.kt)("li",{parentName:"ul"},"Confirm data in SQL database via MySQL Workbench")))),(0,o.kt)("h3",{id:"step-5-cleanup-and-final-verification"},"Step 5: Cleanup and Final Verification"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Verify ECS interval:")," Confirm that the scheduled task has been reverted to its original interval")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Remove duplicate data:")," If testing created duplicate entries, clean them up:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE from Solar_Meters where id = <some id>\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Redundant data is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/OSU-Sustainability-Office/energy-dashboard/pull/220/files#diff-6586f246008ae5ee333b803001847a4b4a69e2bbad28ff73b547375126b99a6bR80"},"handled on the frontend"),", but it's good practice to clean up")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Final verification:")," Confirm everything works in production"))))}c.isMDXComponent=!0},1080:function(e,t,a){t.Z=a.p+"assets/images/webscraper1-4711922623a2fe6a3cc92c93cef40b5d.png"}}]);